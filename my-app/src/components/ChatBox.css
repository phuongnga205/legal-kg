/*Nay chinh co dinh cho khung cha*/
:root{
  --top-offset: 112px;        /* fallback nếu JS chưa kịp set */
  --gap-below-header: 12px;   /* muốn “thấp hơn xíu” chỉnh ở đây */
}

/*Khung lon ben ngoai*/
.chat-container {
  position: fixed;        /* Cố định khung chat vào màn hình (không bị trôi khi cuộn trang). */
  top: calc(112px + ((100vh - 85px - 75.5vh) / 2)); /* dính ngay dưới header+navbar */

  /* canh giữa theo chieu ngang + dịch sang trái bằng 50% chiều rộng để thật sự nằm giữa */
  left: 50%;              
  transform: translateX(-50%); 

  /*Bên trong dùng flex, xếp con theo hàng ngang, căn đỉnh.*/
  display: flex;
  flex-direction: row;
  align-items: flex-start;

  width: 55vw; /*Rộng 95% chiều ngang màn hình.*/
  height: 75.5vh; /*Cao 60% chiều cao màn hình */

  /*Không viền, không bo góc, không margin.*/
  border: none;         
  border-radius: 25px;
  overflow: hidden; /* phần con không được tràn ra ngoài góc bo */
  margin: 0;

  background-color: #f9f8f4; /*Màu nền*/
  box-sizing: border-box; /*Tính padding vào trong width/height (đỡ vỡ layout)*/
  z-index: 800;          /*Nằm trên các phần tử khác (tránh bị che). */

  transition: top 0.3s ease; /*hiệu ứng mượt hơn khi điều chỉnh độ nhỏ lớn của khung*/
}

@media (max-height: 700px) {  /*Khi chiều cao nhỏ hơn 700px, bỏ căn giữa, chỉ dính dưới header*/
  .chat-container {
    top: calc(var(--top-offset) + var(--gap-below-header)); /* dính ngay dưới header+navbar */
  }
}

/*Khung chat*/
.chat-messages {
  flex: 1;  /*Cho khung tin nhắn chiếm hết không gian còn lại theo trục chính của cha (vì cha đang display:flex)*/
  height: calc(78vh - 60px); /*Chiều cao tính theo màn hình: bằng 60% chiều cao viewport, rồi trừ đi 80px*/
  overflow-y: auto; /*Khi nội dung chat dài hơn chiều cao, hiện thanh cuộn dọc. Khi ít nội dung thì không hiện thanh cuộn (tự động).*/
  border: none; /*khong vien*/
  padding: 30px; /*Khoảng trống bên trong.*/
  border-radius: 20px; /*Bo góc riêng cho khung tin nhắn, mềm hơn. Nên đồng bộ với bo góc của .chat-container*/
  background-color: #f9f8f4; /*Màu nền*/
  box-sizing: border-box; /*Tính padding vào trong width/height (đỡ vỡ layout)*/
}


/*Thanh cuon*/
.chat-messages::-webkit-scrollbar {
  width: 8px;                  /* Độ rộng thanh cuộn */
}
.chat-messages::-webkit-scrollbar-track {
  background: transparent;     /* Nền rãnh cuộn */
}
.chat-messages::-webkit-scrollbar-thumb {
  background-color: #f9f8f4; /* Màu nút cuộn */
  border-radius: 4px;          /* Bo góc nút cuộn */
}
.chat-messages::-webkit-scrollbar-thumb:hover { 
  background-color: rgba(37, 33, 33, 0.5); /* Đậm hơn khi hover - di vÀO*/
}

/*Container chua avatar*/
    /* HÀNG TIN NHẮN = GRID 3 CỘT: [avatar trái] [bubble] [avatar phải] */
.msg-row{
  display: flex;
  grid-template-columns: 40px 1fr 40px; /* gutter cố định 40px */
  column-gap: 8px;
  align-items: end;      /* MỌI phần tử trong hàng căn đáy */
  margin: 8px 0;
}

    /* Avatar chung trong hàng */
.msg-row .avatar{
  width: 32px;
  height: 32px;
  border-radius: 50%;          /* tròn chuẩn */
  object-fit: cover;
  box-shadow: 0 1px 2px rgba(0,0,0,.12);
  justify-self: center;        /* giữa theo ngang trong cột gutter */
  transform: translateY(-2px); /*can chinh vi tri avatar theo mong muon */
}


    /* BOT: avatar cột 1, bubble cột 2, bubble căn trái */
.msg-row.bot .avatar{   grid-column: 1; }
.msg-row.bot .message{  grid-column: 2; justify-self: start; }

    /* USER: avatar cột 3, bubble cột 2, bubble căn phải */
.msg-row.user .avatar{  grid-column: 3; }
.msg-row.user .message{ grid-column: 2; justify-self: end; }


/* bong bong chat chung */
.message {
  width: fit-content; 
  max-width: min(50%, 520px);  /* Bubble chung (giới hạn rộng noi dung) */
  padding: 8px 12px; /*Tạo khoảng trống bên trong bong bóng: trên/dưới - trái/phải Giúp chữ không dính sát viền*/
  border-radius: 20px; /*Bo tròn các góc của bong bóng chat (tất cả 4 góc tròn)*/
  margin: 0px 0; /*Tạo khoảng trống 4px trên - dưới giữa các tin nhắn.*/
  white-space: pre-line; /* giữ xuống dòng từ \n */
  word-wrap: break-word; /*Tự xuống dòng nếu từ quá dài (tránh tràn khung)*/
}
  /* bong bong chat cua Bot tin nhắn bên trái */
.message.bot {
  align-self: flex-start;  /* căn trái */
  margin-right: auto; /*day ve ben trai*/ 
  background: #e8d9cd;     /* nền xám nhạt */
  color: #000;
  border-bottom-left-radius: 0; /* góc dưới trái vuông cho đẹp */
}
  /* bong bong chat cua User tin nhắn bên phải */
.message.user {
  align-self: flex-end;    /* căn phải */
  margin-left: auto; /*day ve ben trai*/ 
  background: #efefe9;     /* nền cam nhạt */
  color: #000;
  border-bottom-right-radius: 0; /* góc dưới phải vuông cho đẹp */
}

/*Phan chinh cua input*/
.input-section { /*Tạo thanh nhập tin nhắn luôn nằm dưới cùng màn hình, trải ngang 100%, input + button nằm trên một hàng, có khoảng cách và padding.*/
  position: absolute; /* Đặt vị trí tuyệt đối, bám theo thẻ cha (relative/absolute) */
  bottom: 0; /* Cố định sát mép dưới */
  left: 0; /* Cố định sát mép trái */
  --control-h: 44px; /* chiều cao chung cho cả 2 */
  width: 100%; /* Trải ngang toàn bộ chiều rộng */
  display: flex;  /* Dùng Flexbox để sắp xếp input + button */
  gap: 10px; /* Khoảng cách giữa các phần tử con */
  padding: 10px 14px; /* Khoảng cách bên trong khung */
  align-items: flex-end;   /* nút Gửi thẳng đáy khi textarea cao lên */
  background: #f9f8f4;
  box-sizing: border-box; /* Tính cả padding và border vào width tổng */
  flex-wrap: nowrap; /* Không cho input và button xuống hàng */
}
.input-section textarea { /*Input sẽ tự động giãn ra hết chỗ trống còn lại, có padding thoải mái, chữ rõ ràng, bo góc tròn để đẹp hơn.*/
  flex: 1 1 auto;           /* chiếm hết không gian còn lại */
  min-width: 0; /* Cho phép co lại mà không phá layout */
  /*bắt đầu 1 dòng, nở dần tới 160px*/
  min-height: var(--control-h);  /* ban đầu cao bằng nút */
  max-height: 160px; /* trần */
  height: auto; /* để JS điều khiển */
  line-height:  1.45; /* canh chữ khi ở 20px */

  box-sizing: border-box;      /* ✅ quan trọng: tính cả padding/border vào height */
  padding: 10px 14px;  /* Khoảng cách bên trong input */
  font-size: 16px; /* Kích thước chữ */
  border-radius: 20px; /* Bo tròn góc input */
  scrollbar-gutter: stable;      /* không giật layout khi xuất hiện scrollbar */
}

/*Thanh cuon*/
.input-section textarea::-webkit-scrollbar { 
  width: 8px;  /* Độ rộng thanh cuộn */
}
.input-section textarea::-webkit-scrollbar-track { 
  background: transparent; /* Nền rãnh cuộn */
}
.input-section textarea::-webkit-scrollbar-thumb {
  background-color: #f9f8f4; /* Màu nút cuộn */
  border-radius: 4px;          /* Bo góc nút cuộn */
}
.input-section textarea::-webkit-scrollbar-thumb:hover {
  background-color: rgba(37, 33, 33, 0.5); /* Đậm hơn khi hover - di vÀO*/
}

/*nut gui*/
.input-section button {/*Nút luôn giữ kích thước cố định, đẹp mắt, bo góc tròn, có màu nền tối và chữ sáng.*/
  height: var(--control-h); /*cùng chiều cao với textarea ban đầu */
  padding: 0px 20px; /* Khoảng cách bên trong: 10px trên/dưới, 20px trái/phải */
  flex-shrink: 0; /* Không cho nút co nhỏ lại khi màn hình hẹp */
  font-size: 16px; /* Kích thước chữ nút */
  background-color: #1a1a19;
  color: #dfdfd9; /* Màu chữ xám nhạt */
  border: none; /* Bỏ viền */
  border-radius: 20px;  /* Bo tròn góc nút */
  cursor: pointer; /* Khi hover hiện icon bàn tay */
  white-space: nowrap; /* Không cho text trong nút bị xuống dòng */
}
@media (max-width: 400px) { /*Khi màn hình hẹp (≤400px, ví dụ trên điện thoại nhỏ), input và nút sẽ thu gọn lại (chữ nhỏ hơn, padding nhỏ hơn) để không bị chiếm quá nhiều diện tích.*/
  .input-section textarea,
  .input-section button {
    font-size: 14px; /* Giảm cỡ chữ khi màn hình nhỏ */
    padding: 8px; /* Giảm padding để vừa hơn */
  }
}

/* Bubble kết quả (dựa trên .message.bot) */
.message.result-bubble {
  max-width: min(70%, 720px);
  background: #e8d9cd; /* cùng tông bot */
  padding: 10px 12px;
}

/* Header tóm tắt — click để mở/đóng */
.result-header {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  background: transparent;
  border: 0;
  cursor: pointer;
  font: inherit;
  color: inherit;
  text-align: left;
  padding: 4px 2px;
}

.result-icon { opacity: .9; }
.result-title { font-weight: 600; }
.result-caret {
  margin-left: auto;
  transform: rotate(45deg);     /* ↗ khi đóng */
  transition: transform .15s ease;
}
.result-caret.open { transform: rotate(225deg); } /* ↘ khi mở */

/* Thân kết quả nhúng ResultPanel */
.result-body {
  margin-top: 8px;
  background: #fff;
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,.06);
}
.result-body .results { padding: 0; }
.result-body .grid { gap: 10px; }
.result-body .card { border-radius: 10px; }